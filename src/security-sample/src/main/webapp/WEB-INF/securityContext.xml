<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:sec="http://www.springframework.org/schema/security"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
		http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-4.0.xsd
		http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd">

    <import resource="classpath*:securityServicesContext.xml"/>

    <aop:aspectj-autoproxy/>

    <!-- Web Security -->

    <sec:http pattern="/css/**" security="none"/>

    <sec:http pattern="/rest/**" create-session="stateless">
        <sec:expression-handler ref="webSecurityExpressionHandler"/>
        <sec:intercept-url pattern="/**" access="hasRole('REMOTE_SYSTEM')"/>
        <sec:http-basic/>
    </sec:http>

    <sec:http>
        <sec:expression-handler ref="webSecurityExpressionHandler"/>
        <sec:intercept-url pattern="/login" access="permitAll()"/>
        <sec:intercept-url pattern="/**" access="isAuthenticated()"/>
        <sec:form-login login-page="/login" authentication-failure-url="/login?error" default-target-url="/customers"/>
        <sec:logout/>
    </sec:http>

    <!-- Method Security -->

    <sec:global-method-security pre-post-annotations="enabled">
        <sec:expression-handler ref="methodSecurityExpressionHandler"/>
    </sec:global-method-security>

    <!-- ACL security aspects -->

    <bean class="com.itechart.security.hibernate.aop.AclHibernateSecurityAspect">
        <property name="filterParamsBuilder">
            <bean class="com.itechart.security.hibernate.filter.FilterParamsBuilder">
                <property name="securityRepository" ref="securityRepository"/>
                <property name="roleHierarchy" ref="roleHierarchy"/>
            </bean>
        </property>
    </bean>

</beans>